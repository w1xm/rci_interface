<!doctype html>
<html ng-app="app">
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="https://cdn.rawgit.com/AngularClass/angular-websocket/v2.0.0/dist/angular-websocket.min.js"></script>
    <script src="components.js"></script>
    <script src="app.js"></script>
    <link rel="stylesheet" href="app.css" />
  </head>
  <body>
    <section ng-controller="StatusController">
      <svg ng-controller="MapController" width="1000" height="1000" xmlns="http://www.w3.org/2000/svg" ng-mousedown="$event.preventDefault()" >
	<defs>
	  <clipPath id="elClip">
	    <rect width="90" x="5" y="5" height="90" />
	  </clipPath>
	</defs>
	<g ng-click="mapClick($event)" ng-mousemove="$event.buttons && mapClick($event)">
	  <image href="map.jpg" width="1000" height="1000" />
	  <line x1="500" y1="500" x2="500" y2="-500" transform="rotate({{rci.status.AzPos}} 500 500)" stroke="black" stroke-width="2" />
	  <line x1="500" y1="500" x2="500" y2="-500" class="{{rci.status.CommandAzFlags == 'POSITION'?'':'ng-hide'}}" transform="rotate({{rci.status.CommandAzPos}} 500 500)" stroke="red" />
	</g>
	<g ng-click="elClick($event)" ng-mousemove="$event.buttons && elClick($event)">
	  <rect width="100" height="100" fill="white" />
	  <g clip-path="url(#elClip)">
	    <path d="M 10 10 L 10 90 L 90 90" fill="none" stroke="black" stroke-width="2"/>
	    <line x1="10" x2="200" y1="90" y2="90" transform="rotate({{-rci.status.ElPos}} 10 90)" stroke="black" stroke-width="2" />
	    <line x1="10" x2="200" y1="90" y2="90" class="{{rci.status.CommandElFlags == 'POSITION'?'':'ng-hide'}}" transform="rotate({{-rci.status.CommandElPos}} 10 90)" stroke="red" />
	  </g>
	</g>
      </svg>
    </section>
    <section ng-controller="StatusController">
      <table>
	<tr><th colspan="2">Status</th></tr>
	<tr><th>Diag</th><td>{{rci.status.Diag}}</td></tr>
	<tr><th>Azimuth</th><td>{{rci.status.AzPos | deg}}° {{rci.status.AzVel}} °/s</td></tr>
	<tr><th>Elevation</th><td>{{rci.status.ElPos | deg}}° {{rci.status.AzVel}} °/s</td></tr>
	<tr><th>In</th><td>{{rci.status.Registers | bits}}</td></tr>
	<tr><th>Mode</th><td><ul>
	      <li ng-show="{{rci.status.LocalMode}}">Local Mode</li>
	      <li ng-show="{{rci.status.MaintenanceMode}}">Maintenance Mode</li>
	      <li ng-show="{{rci.status.ElevationLower}}">Elevation Lower</li>
	      <li ng-show="{{rci.status.ElevationUpper}}">Elevation Upper</li>
	      <li ng-show="{{rci.status.Simulator}}">Simulator</li>
	      <li ng-show="{{rci.status.BadCommand}}">Bad Command</li>
	      <li ng-show="{{rci.status.HostOkay}}">Host Okay</li>
	      <li ng-show="{{rci.status.ShutdownError}}">Shutdown {{rci.status.ShutdownError}}</li>
	</ul></td></tr>

	<tr><th colspan="2">Command</th></tr>
	<tr><th>Diag</th><td>{{rci.status.CommandDiag}}</td></tr>
	<tr><th>Azimuth</th><td>{{rci.status.CommandAzFlags}} {{rci.status.CommandAzPos | deg}}° {{rci.status.CommandAzVel}} °/s</td></tr>
	<tr><th>Elevation</th><td>{{rci.status.CommandElFlags}} {{rci.status.CommandElPos | deg}}° {{rci.status.CommandAzVel}} °/s</td></tr>
	<tr><th>Tracking</th><td>{{rci.status.Bodies[rci.status.CommandTrackingBody]}}</td></tr>
	<tr><td></td><td><button ng-click="rci.stop()">STOP</button><button ng-click="rci.stopHard()">HARD STOP</button></tr>
      </table>
    </section>
  </body>
</html>
